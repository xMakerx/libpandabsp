cmake_minimum_required (VERSION 2.6)

project(libpandabsp)

# Setup paths to dependencies

set(PANDA C:/Users/maver/Documents/OpenCIO/opencio-panda3d/built_x64 CACHE PATH "Path to root Panda3D SDK directory.")
string(REGEX REPLACE "/" "\\\\" PANDA_BACK ${PANDA})
set(LIBPANDA ${PANDA}/lib)
set(LIBPANDA_BACK ${PANDA_BACK}\\lib)
set(INCPANDA ${PANDA}/include)
set(BINPANDA ${PANDA}/bin)
set(BINPANDA_BACK ${PANDA_BACK}\\bin)
set(LIBPANDA_PY ${PANDA}/python/libs)
set(INCPANDA_PY ${PANDA}/python/include)

set(EMBREE C:/Users/maver/Documents/OpenCIO/opencio-panda3d/libpandabsp/embree-3.12.1.x64.vc14.windows CACHE PATH "Path to root Embree SDK directory.")
set(INCEMBREE ${EMBREE}/include)
set(LIBEMBREE ${EMBREE}/lib)

set(BULLET C:/Users/maver/Documents/OpenCIO/opencio-panda3d/thirdparty/win-libs-vc14-x64/bullet CACHE PATH "Path to thirdparty Bullet directory.")
set(INCBULLET ${BULLET}/include)
set(LIBBULLET ${BULLET}/lib)

set(INCGNS C:/Users/brian/OneDrive/Documents/Projects/libpandabsp/src/dependencies/GameNetworkingSockets/include CACHE PATH "Path to GameNetworkingSockets include directory.")
set(LIBGNS C:/Users/brian/OneDrive/Documents/Projects/libpandabsp/src/dependencies/GameNetworkingSockets/src/RelWithDebInfo/GameNetworkingSockets CACHE FILEPATH "Path to GameNetworkingSockets library.")

add_compile_definitions(WITHIN_PANDA)

if(CMAKE_SIZEOF_VOID_P EQUAL 8)
    # 64 bits
    set(PLATFORM_BITS 64)
	add_compile_definitions(VERSION_64BIT)
elseif(CMAKE_SIZEOF_VOID_P EQUAL 4)
    # 32 bits
	set(PLATFORM_BITS 32)
    add_compile_definitions(VERSION_32BIT)
endif()

if (DEFINED LINK_ALL_STATIC)
    set(LIB_TYPE STATIC)
    add_compile_definitions(LINK_ALL_STATIC)
else ()
    set(LIB_TYPE SHARED)
endif ()

set(CMAKE_BUILD_TYPE Release CACHE STRING "Build type.")

macro(bsp_setup_target targetname)
	set(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /Zi")
	set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} /DEBUG")
	#string(REPLACE "/DNDEBUG" "" CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE}")
	#string(REPLACE "/DNDEBUG" "" CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE}")

	if (DEFINED LINK_ALL_STATIC)
		add_custom_command(TARGET ${targetname} POST_BUILD COMMAND copy /Y ${CMAKE_BUILD_TYPE}\\${targetname}.lib ${LIBPANDA_BACK}\\${targetname}.lib)
	else()
		add_custom_command(TARGET ${targetname} POST_BUILD COMMAND copy /Y ${CMAKE_BUILD_TYPE}\\${targetname}.dll ${BINPANDA_BACK}\\${targetname}.dll)
		add_custom_command(TARGET ${targetname} POST_BUILD COMMAND copy /Y ${CMAKE_BUILD_TYPE}\\${targetname}.pdb ${BINPANDA_BACK}\\${targetname}.pdb)
	endif()
endmacro()


add_subdirectory(tools/keyvalue-parser)
add_subdirectory(tools/common)
add_subdirectory(libpandabsp)
#add_subdirectory(networksystem)

#add_subdirectory(tools/p3csg)
#add_subdirectory(tools/p3bsp)
#add_subdirectory(tools/p3vis)
#add_subdirectory(tools/p3rad)